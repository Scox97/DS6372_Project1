---
title: "DS 6372 Project 1"
author: 'MSDS 6372: Stephanie Duarte'
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# setwd("~/OneDrive - Southern Methodist University/Git_Website/DS6372_Project1")
library(ggthemes)
library(gridExtra)
library(ggplot2)
library(GGally)
library(dplyr)
library(tidyr)
library(knitr)
library(caret)
library(readr)

```

## Life Expectancy Data Set

```{r}
life <- read_csv("MSDS_6372/Unit 4/Life Expectancy Data.csv")
life <- read.csv("Data/Life_Expectancy_Data.csv")
summary(life)
sapply(life, class)

```
#Chceking missing values and gandling missing values

```{r}
pureData <- na.omit(life)
na.fail(pureData)
#Missing values, pure data has zero missing values, good to start analysis
sum(is.na(pureData))
#Data Summary, after clearning missing values
summary(pureData)
str(pureData)

#Rang of life expectancy is 44 and 89
range(pureData$"Life expectancy")

```

#Chceking correlation and variance, LE has strong correlation with Schooling&IncomeComposition. LE has negative correlation with Adult Mortality. And weka correlation with populations and measles. Strong correlation between infant death and underfivedeath

```{r}
data_num <- pureData %>% 
                             select_if(is.numeric)

ggcorr(data_num, 
       label = T, 
       label_size = 2,
       label_round = 2,
       hjust = 1,
       size = 3, 
       color = "royalblue",
       layout.exp = 5,
       low = "green3", 
       mid = "gray95", 
       high = "darkorange",
       name = "Correlation")


```

# status for each country developed and developing, added dplyr to avoid R confusion with plyr
#Developed    242 14.68%    , Developing  1407 85.32% 
```{r}
  pureData %>% 
                 group_by(Status) %>% 
                 dplyr::summarise(count = n()) %>% 
                 mutate(percentage = paste0(round(count/sum(count)*100, 2), "%"))
                 
###Plot by developed and Developing. I believe there was a grahp done for this.

```


```{r}
##Life expectancy Distribution
#Verifying normality of target variable Life Expectancy, we can see from the plot that LE is not distributed perfectly normal, its little left skewed. 
par(mfrow=c(1,2))
hist(pureData$"Life expectancy",
     main = "Life Expectancy Distribution",
     xlab = "Life Expectancy(yrs)")

```


```{r}
#Creating model
#This function is removing the columns Country and Year from the pureData data frame.
life_selected <- pureData %>% 
                 select(-Country, -Year) %>% 
                 mutate(`Hepatitis B` = ifelse(`Hepatitis B` < 90, "<90% Covered", ">=90% Covered"),
                        Polio = ifelse(Polio < 90, "<90% Covered", ">=90% Covered"),
                        Diphtheria = ifelse(Diphtheria < 90, "<90% Covered", ">=90% Covered"),
                        `Hepatitis B` = as.factor(`Hepatitis B`),
                        Polio = as.factor(Polio),
                        Diphtheria = as.factor(Diphtheria))


str(life_selected)

LEmodel <- lm(`Life expectancy` ~ ., data = life_selected)
summary(LEmodel)

#training and test set 80/20 split
set.seed(1234)
trainIndex<-createDataPartition(life_selected$"Life expectancy",p=.80,list=F)

train<-life_selected[trainIndex,]
test<-life_selected[-trainIndex,]

```

# Chcekng ouliner, Most of the columns have many outliers except Alcohol, BMI, Income compositionofresources. 
```{r}
par(mfrow=c(1,3))
boxplot(pureData$"Life expectancy",
        ylab = "Life Expectancy",
        main = "Boxplot of Life Expectancy")

boxplot(pureData$"Adult Mortality",
        ylab = "Adult Mortality",
        main = "Boxplot of Adult Mortality")

boxplot(pureData$Alcohol,
        ylab = "Alcohol",
        main = "Boxplot of Alcohol")
par(mfrow=c(1,3))
boxplot(pureData$"Hepatitis B",
        ylab = "Hepatitis B",
        main = "Boxplot of Hepatitis B")

boxplot(pureData$BMI,
        ylab = "BMI",
        main = "Boxplot of BMI")

boxplot(pureData$Polio,
        ylab = "Polio",
        main = "Boxplot of Polio")
par(mfrow=c(1,3))
boxplot(pureData$"Total expenditure",
        ylab = "Total Expenditure",
        main = "Boxplot of Total Expenditure")

boxplot(pureData$"thinness 1-19 years",
        ylab = "Thinness 1-19 years",
        main = "Boxplot of Thinness for 1-19 years old")
boxplot(pureData$"thinness 5-9 years",
        ylab = "Thinness 5-9 years",
        main = "Boxplot of Thinness for 5-9 years old")
par(mfrow=c(1,3))
boxplot(pureData$"Income composition of resources",
        ylab = "Income Composition",
        main = "Boxplot of Income Composition")
boxplot(pureData$Schooling,
        ylab = "Schooling",
        main = "Boxplot of Schooling")

```


```{r}

# LE VS Schooling, positively correlated
# Plotting Life Expectancy vs. Schooling
plot(y = pureData$`Life expectancy`, x = pureData$Schooling, 
     main = "Life Expectancy vs. Schooling", 
     xlab = "Schooling", 
     ylab = "Life Expectancy", 
     pch = 19, col = "orange")

#LE vs Adult Morality: negatively correlated
plot(y = pureData$"Life expectancy",x = pureData$"Adult Mortality",main = "Life Expectancy vs. Adult Mortality",xlab = "Adult Mortality",ylab = "Life Expectancy",pch = 19,col = "yellow")

#LE VS Population, not correlated
plot(y = pureData$"Life expectancy",x = pureData$Population,main = "Life Expectancy vs. Population",xlab = "Population",
ylab = "Life Expectancy",pch = 19,col = "red")


# life expectancy vs. income composition positively correlated
plot(y = pureData$"Life expectancy",x = pureData$"Income composition of resources",main = "Life Expectancy vs. Income compositions",
     xlab = "Income composition of resources",
     ylab = "Life Expectancy",
     pch = 19,
     col = "blue")

```


```{r}
# model created using strong correlated and training data set
modelLE <- lm(`Life expectancy` ~ Schooling +  `BMI` + `Income composition of resources`+  `HIV/AIDS`, data = train)

summary(modelLE)  